---
description: Directory structure and organization of the Founder LLM (Calix) project - a full-stack AI legal assistant application
globs: **/*
alwaysApply: true
---
# Founder LLM Project Structure

This rule outlines the directory structure and organization of the **Founder LLM** (also known as **Calix**) project - a full-stack AI-powered legal assistant application for startup founders.

## Project Overview

**Founder LLM** is a full-stack application that provides:
- ğŸ¤– **AI Chat Interface** - Real-time chat with AI legal assistant using OFI's O5 model
- ğŸ“„ **Document Processing** - PDF parsing, intelligent chunking, and context-aware responses
- ğŸ’¾ **Supabase Integration** - Secure data storage with Row Level Security (RLS)
- ğŸ” **Authentication** - Supabase Auth integration for user management
- ğŸš€ **Cloud Deployment** - Production-ready Docker and Cloud Run configuration
- ğŸ“Š **Admin Dashboard** - CRM overview with usage statistics

## Root Directory Structure

```
founder-llm/
â”œâ”€â”€ backend/              # ğŸ FastAPI Python backend
â”œâ”€â”€ frontend/             # âš›ï¸ Next.js React frontend
â”œâ”€â”€ README.md             # ğŸ“– Root project documentation
â”œâ”€â”€ AUTH_SETUP.md         # ğŸ” Authentication setup guide
â”œâ”€â”€ TESTING_GUIDE.md      # ğŸ§ª Testing documentation
â””â”€â”€ .cursor/              # ğŸ“ Cursor IDE configuration
    â””â”€â”€ rules/            # ğŸ“‹ Cursor rules and guidelines
```

## Backend Directory (`/backend/`)

**Purpose**: FastAPI backend API with document processing, LLM integration, and Supabase operations.

```
backend/
â”œâ”€â”€ app/                  # ğŸ Main application code
â”‚   â”œâ”€â”€ __init__.py       # Package initialization
â”‚   â”œâ”€â”€ main.py           # FastAPI app and routes
â”‚   â”œâ”€â”€ models.py         # Pydantic data models
â”‚   â”œâ”€â”€ supabase_client.py # Supabase client and operations
â”‚   â”œâ”€â”€ llm_providers.py  # OFI/OpenAI LLM integrations
â”‚   â”œâ”€â”€ ingest.py         # Document processing and chunking
â”‚   â””â”€â”€ utils.py          # Utility functions
â”œâ”€â”€ requirements.txt      # ğŸ“¦ Python dependencies
â”œâ”€â”€ Dockerfile           # ğŸ³ Container configuration
â”œâ”€â”€ service.yaml         # â˜ï¸ Cloud Run service config
â”œâ”€â”€ cloudbuild.yaml      # ğŸ”¨ Cloud Build configuration
â”œâ”€â”€ deploy.sh            # ğŸš€ Deployment script
â”œâ”€â”€ start.sh             # â–¶ï¸ Linux start script
â”œâ”€â”€ start.bat            # â–¶ï¸ Windows start script
â”œâ”€â”€ supabase.sql         # ğŸ—„ï¸ Database schema
â”œâ”€â”€ fix_storage_policies.sql # ğŸ”§ Storage policy fixes
â”œâ”€â”€ fix_storage_policies_v2.sql # ğŸ”§ Storage policy fixes v2
â”œâ”€â”€ test_api.py          # ğŸ§ª API integration tests
â”œâ”€â”€ test_connection.py   # ğŸ”Œ Connection tests
â”œâ”€â”€ test_create_chat.py  # ğŸ’¬ Chat creation tests
â”œâ”€â”€ test_openai.py       # ğŸ¤– OpenAI integration tests
â”œâ”€â”€ test_stream.py       # ğŸŒŠ Streaming tests
â”œâ”€â”€ venv/                # ğŸ Python virtual environment
â”œâ”€â”€ README.md            # ğŸ“– Backend documentation
â”œâ”€â”€ ARCHITECTURE.md      # ğŸ—ï¸ Architecture documentation
â”œâ”€â”€ QUICKSTART.md        # âš¡ Quick start guide
â”œâ”€â”€ QUICK_REFERENCE.md   # ğŸ“š Quick reference
â”œâ”€â”€ SETUP_CHECKLIST.md   # âœ… Setup checklist
â”œâ”€â”€ PROJECT_SUMMARY.md   # ğŸ“Š Project summary
â”œâ”€â”€ README_UPDATED.md    # ğŸ“ Updated README
â”œâ”€â”€ MIGRATION_TO_OPENAI.md # ğŸ”„ Migration guide
â””â”€â”€ OPENAI_FILE_EXTRACTION.md # ğŸ“„ File extraction docs
```

### Backend Application Structure

#### `app/main.py`
- FastAPI application initialization
- CORS middleware configuration
- API route definitions:
  - Health check endpoints (`/`, `/health`)
  - Chat operations (`/v1/chats/*`)
  - File operations (`/v1/files/*`)
  - User operations (`/v1/users/*`)
  - Admin operations (`/v1/admin/*`)
- Server-Sent Events (SSE) streaming for chat responses

#### `app/models.py`
- Pydantic models for request/response validation
- Chat, Message, File, and User data models
- Type definitions for API contracts

#### `app/supabase_client.py`
- Supabase client initialization
- Database operations (CRUD for chats, messages, files)
- Storage bucket operations
- Row Level Security (RLS) integration

#### `app/llm_providers.py`
- OFI API integration for O5 model
- OpenAI API integration (optional)
- Streaming chat completion handlers
- Token management and response formatting

#### `app/ingest.py`
- Document processing pipeline
- PDF text extraction
- Intelligent chunking algorithms
- File context retrieval for chat

#### `app/utils.py`
- Environment variable management
- Configuration helpers
- File path generation
- Admin key verification

### Backend Configuration Files

- **`requirements.txt`**: Python dependencies (FastAPI, Supabase, OpenAI, etc.)
- **`Dockerfile`**: Container image for Cloud Run deployment
- **`service.yaml`**: Google Cloud Run service configuration
- **`cloudbuild.yaml`**: Cloud Build CI/CD configuration
- **`supabase.sql`**: Database schema with tables, indexes, and RLS policies

### Backend Test Files

- **`test_api.py`**: API endpoint integration tests
- **`test_connection.py`**: Supabase connection verification
- **`test_create_chat.py`**: Chat creation flow tests
- **`test_openai.py`**: OpenAI integration tests
- **`test_stream.py`**: SSE streaming functionality tests

## Frontend Directory (`/frontend/`)

**Purpose**: Next.js 14 React application with TypeScript, Tailwind CSS, and Supabase integration.

```
frontend/
â”œâ”€â”€ app/                  # âš›ï¸ Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx        # Root layout component
â”‚   â”œâ”€â”€ page.tsx          # Main chat page
â”‚   â”œâ”€â”€ globals.css       # Global styles
â”‚   â”œâ”€â”€ login/           # ğŸ” Login page
â”‚   â”‚   â””â”€â”€ page.tsx     # Login component
â”‚   â””â”€â”€ admin/           # ğŸ“Š Admin dashboard
â”‚       â””â”€â”€ page.tsx     # Admin page
â”œâ”€â”€ components/           # ğŸ¨ React components
â”‚   â”œâ”€â”€ chat/            # ğŸ’¬ Chat components
â”‚   â”‚   â””â”€â”€ ChatInterface.tsx # Main chat UI with SSE streaming
â”‚   â””â”€â”€ files/           # ğŸ“„ File components
â”‚       â”œâ”€â”€ FileUpload.tsx # File upload component
â”‚       â””â”€â”€ FileList.tsx  # File management component
â”œâ”€â”€ contexts/            # ğŸ”„ React contexts
â”‚   â””â”€â”€ AuthContext.tsx  # Authentication context
â”œâ”€â”€ lib/                 # ğŸ› ï¸ Utility libraries
â”‚   â”œâ”€â”€ api.ts           # Backend API client
â”‚   â”œâ”€â”€ auth.ts          # Authentication utilities
â”‚   â””â”€â”€ supabase.ts      # Supabase client
â”œâ”€â”€ package.json         # ğŸ“¦ Node.js dependencies
â”œâ”€â”€ package-lock.json    # ğŸ”’ Dependency lock file
â”œâ”€â”€ next.config.js       # âš™ï¸ Next.js configuration
â”œâ”€â”€ tsconfig.json        # ğŸ“˜ TypeScript configuration
â”œâ”€â”€ tailwind.config.ts   # ğŸ¨ Tailwind CSS configuration
â”œâ”€â”€ postcss.config.js    # ğŸ”§ PostCSS configuration
â”œâ”€â”€ next-env.d.ts        # ğŸ”· Next.js type definitions
â”œâ”€â”€ node_modules/        # ğŸ“š Installed dependencies
â”œâ”€â”€ README.md            # ğŸ“– Frontend documentation
â””â”€â”€ SETUP.md             # âš™ï¸ Setup instructions
```

### Frontend Application Structure

#### `app/` - Next.js App Router
- **`layout.tsx`**: Root layout with providers and global structure
- **`page.tsx`**: Main chat interface page
- **`globals.css`**: Global styles and Tailwind CSS imports
- **`login/page.tsx`**: User authentication page
- **`admin/page.tsx`**: Admin dashboard page

#### `components/` - React Components
- **`chat/ChatInterface.tsx`**: 
  - Real-time chat interface
  - SSE streaming integration
  - Message history display
  - File context integration
- **`files/FileUpload.tsx`**: 
  - File upload UI
  - Signed URL generation
  - OpenAI extraction integration
- **`files/FileList.tsx`**: 
  - File listing and selection
  - File metadata display
  - File deletion

#### `contexts/` - React Contexts
- **`AuthContext.tsx`**: 
  - Authentication state management
  - User session handling
  - Supabase auth integration

#### `lib/` - Utility Libraries
- **`api.ts`**: 
  - Backend API client functions
  - SSE streaming helpers
  - Request/response types
- **`auth.ts`**: 
  - Authentication helpers
  - Session management
- **`supabase.ts`**: 
  - Supabase client initialization
  - Client-side configuration

### Frontend Configuration Files

- **`package.json`**: Node.js dependencies (Next.js, React, Supabase, Tailwind, etc.)
- **`next.config.js`**: Next.js framework configuration
- **`tsconfig.json`**: TypeScript compiler options
- **`tailwind.config.ts`**: Tailwind CSS theme and plugin configuration
- **`postcss.config.js`**: PostCSS processing configuration

## Key Configuration Files

### Environment Variables

**Backend** (`.env`):
```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
OFI_API_KEY=your-ofi-api-key
O5_MODEL_ID=o5-preview
OPENAI_API_KEY=your-openai-key
ALLOWED_ORIGINS=http://localhost:3000
ADMIN_API_KEY=your-secure-admin-key
```

**Frontend** (`.env.local`):
```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
NEXT_PUBLIC_API_URL=http://localhost:8080
```

### Database Schema

**`backend/supabase.sql`**:
- `chats` table - Chat sessions
- `messages` table - Chat messages
- `files` table - Uploaded documents
- `file_chunks` table - Processed document chunks
- Row Level Security (RLS) policies
- Database indexes for performance

## File Naming Conventions

### Backend (Python)
- **Snake_case**: `supabase_client.py`, `test_api.py`
- **PascalCase**: Class names in models
- **Descriptive**: Clear purpose indication

### Frontend (TypeScript/React)
- **PascalCase**: Component files (`ChatInterface.tsx`)
- **camelCase**: Function and variable names
- **kebab-case**: Directory names (`file-upload`)
- **PascalCase**: Type/interface names

## Technology Stack

### Backend
- **FastAPI** 0.109.0 - Web framework
- **Uvicorn** 0.27.0 - ASGI server
- **Supabase** 2.9.1 - Database and storage
- **OpenAI** 1.10.0 - Document processing
- **Pydantic** 2.9.2 - Data validation
- **httpx** 0.27.2 - HTTP client
- **sse-starlette** 1.8.2 - Server-Sent Events

### Frontend
- **Next.js** 14.1.0 - React framework
- **React** 18.2.0 - UI library
- **TypeScript** 5.3.3 - Type safety
- **Tailwind CSS** 3.4.1 - Styling
- **Supabase JS** 2.39.3 - Supabase client
- **Lucide React** 0.316.0 - Icons
- **React Markdown** 9.0.1 - Markdown rendering

## Deployment Configuration

### Backend
- **Docker**: Containerized for Cloud Run
- **Cloud Run**: Serverless container deployment
- **Cloud Build**: CI/CD pipeline
- **Environment**: Managed via Secret Manager or env vars

### Frontend
- **Vercel**: Recommended hosting platform
- **Next.js**: Optimized for production builds
- **Environment**: Configured via Vercel dashboard

## Development Workflow

### Backend Development
1. Activate virtual environment: `venv\Scripts\activate` (Windows) or `source venv/bin/activate` (Linux/Mac)
2. Install dependencies: `pip install -r requirements.txt`
3. Configure environment: Copy `.env.sample` to `.env`
4. Run server: `uvicorn app.main:app --reload --port 8080`
5. Access docs: `http://localhost:8080/docs`

### Frontend Development
1. Install dependencies: `npm install`
2. Configure environment: Create `.env.local`
3. Run dev server: `npm run dev`
4. Access app: `http://localhost:3000`

## Documentation Files

### Root Level
- **`README.md`**: Project overview
- **`AUTH_SETUP.md`**: Authentication setup guide
- **`TESTING_GUIDE.md`**: Testing procedures

### Backend Documentation
- **`README.md`**: Backend setup and API documentation
- **`ARCHITECTURE.md`**: System architecture
- **`QUICKSTART.md`**: Quick start guide
- **`QUICK_REFERENCE.md`**: API quick reference
- **`SETUP_CHECKLIST.md`**: Setup verification checklist
- **`PROJECT_SUMMARY.md`**: Project overview
- **`MIGRATION_TO_OPENAI.md`**: Migration guide
- **`OPENAI_FILE_EXTRACTION.md`**: File extraction documentation

### Frontend Documentation
- **`README.md`**: Frontend setup and usage
- **`SETUP.md`**: Detailed setup instructions

## Important Patterns

### API Communication
- Backend exposes REST API at `/v1/*` endpoints
- Frontend uses `/lib/api.ts` for API calls
- SSE streaming for real-time chat responses
- Signed URLs for secure file uploads

### Authentication Flow
- Supabase Auth for user authentication
- JWT tokens for session management
- Service role key for backend operations
- Anon key for frontend operations

### File Processing Flow
1. Frontend requests signed upload URL
2. File uploaded to Supabase Storage
3. Backend processes file (extraction + chunking)
4. File chunks stored in database
5. Chat responses use file context

### Database Patterns
- Row Level Security (RLS) enabled
- User-scoped data isolation
- Efficient indexing for queries
- Background processing for file ingestion

## Cursor Rules Location

All Cursor rules are located in:
```
.cursor/rules/
â”œâ”€â”€ project-structure.mdc  # This file
â””â”€â”€ [other-rules].mdc      # Additional rules
```

Rules follow the `.mdc` extension format and include metadata headers for Cursor IDE integration.
